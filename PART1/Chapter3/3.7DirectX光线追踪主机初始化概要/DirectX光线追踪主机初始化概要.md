## 3.7DirectX光线追踪主机初始化概要
至今，我们关注的是DirectX光线追踪必要着色器代码。如果是从支持DXR的引擎或框架开始，这些已经足够了。但如果是从零开始，你必须了解一些DirectX主机侧初始化你自己光线追踪器的代码。主要的初始化步骤包括（详情会在3.8~3.11描述）：

1、初始化一个DirectX设备，同时核实它是否支持光线追踪。
2、建立一个光线加速结构，并指定你的场景几何体。
3、加载并编译你的着色器。
4、定义根签名和着色器表用于从CPU往GPU传递渲染参数。
5、为自己的光线追踪渲染管线定义一个DirectX的管线状态对象。
6、发送工作到GPU，使其真正地追踪光线。

与所有的DirectX 12的APIs一样，光线追踪的API也是底层且冗长的。甚至一些简单的样例在分配所有资源，运行效验和检查错误以后也超过1000行C++代码。所以为了清晰简洁，我们之后的代码片段关注于光线追踪中新且关键的函数和结构。

3.7.1深入理解心智模式
当尝试理解这些代码片段的时候，需要牢记目标。和光栅化不同，光线追踪中，每条光线可能会相交于任意几何和材质。在允许这种灵活性的同时实现高性能意味着：在GPU上，对于所有潜在的交叉表面 可使用的着色器数据必须以一种良好的组织和易于索引的格式存在。最终的结果是在DirectX中，追踪光线的过程和着色相交曲面是耦合的，而在离线或CPU光线追踪中，这两者操作往往是独立的。

思考3.4中，新的渲染着色器阶段。光线生成着色器是基于一个标准的GPU可编程模型，它可以并行的调用线程组。但其他的着色器程序高效地充当了回调：当光线碰撞了一个球体，运行一个；运行另一个来给三角形上的一个点着色；当错过了所有的几何体时，运行第三个。
生成着色器、唤醒着色器，并且需要在没有连续执行历史记录的情况下标识要执行的工作。
如果生成着色器的工作依赖于几何属性，那么DirectX需要理解这种关系。例如，最接近的阴影可能依赖于在交叉过程中计算的表面法线。

What information is needed to identify the correct shader to run for a surface?
哪些信息是识别正确运行的着色器所必须的呢？

取决于你的光线线追踪器的复杂性，着色器可能会变化基于以下几点:
1、光线类型：光线可能需要不同的计算（例如：阴影）
2、图元类型：三角形、球体、圆锥体等，可能存在不同的需求。
3、图元标识符：每个图元可能使用不同的材质。
4、实例标识符：实例可能改变所需的着色（the required shading）。

实际上，在DirectX运行时，着色器选择器是一系列参数的组合提供给TraceRay()、几何信息和每个实例的数据。

实时光线追踪为了高效实现灵活地追踪和必须的==着色==操作，DXR加入两个新的数据结构：加速结构和着色器表。着色器表特别的重要因为它们充当了将光线、几何图形和着色（shading）操作粘合在一起的胶水。我们将会在段落3.8.1和3.10详细介绍这两者。