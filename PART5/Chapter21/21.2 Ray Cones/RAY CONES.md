###光锥

在本节，我们将描述如何使用光锥来选取环境贴图对应的 Mipmap 层级。光锥由宽度 *w* 和扩散角 $\gamma$ 表示（参见第 20 章）。

对于分辨率为 $2h × h$ （即宽为高两倍）的经纬度环境贴图，我们用公式

$$\lambda = \log _2{\frac{ \gamma }{\pi /h}}\tag{1} $$  

计算细节层级 $\lambda $，其中 $h$ 是贴图的高度，分母为 $\pi /h$ ，近似等于贴图中每个像素对应的弧度，因为整个贴图在纵向包括了 $\pi$ 弧度。函数 $\log_2$  用于将此映射到 Mipmap 层级。其背后的原理是，如果 $\gamma = \pi/h$ ，那么 $\log_2{1} = 0$ ，则我们选取第 0 个 Mipmap 层级；如果 $\gamma$ 为 $\pi/h$ 的 8 倍大，那么 $\log_2{8} = 3$ ，则我们选取第 3 个 Mipmap 层级。

对于长宽相等且分辨率为的 $h × h$ 的立方体贴图，我们使用公式

$$ \lambda = \log _2{\frac{ \gamma }{\pi /h}}\tag{2} ，$$  

原因同上，但此时长宽各覆盖了 $0.5\pi$ 弧度。



